<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>AdPlayer Lite iOS</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">AdPlayer Lite iOS</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>This book describes how to work with AdPlayer Lite library.</p>
<h2 id="tags"><a class="header" href="#tags">Tags</a></h2>
<p>AdPlayer Lite library works with publishers and tags. Publisher is a unique ID for the whole organization, while Tag is a placement configration on the screen. There can be any number of tags but only one publisher.</p>
<p>Tags can be created and configured by using the <a href="https://manage.aniview.com/">admin console</a>.</p>
<h2 id="types-of-tags"><a class="header" href="#types-of-tags">Types of Tags</a></h2>
<p>Tags can be split into to categories:</p>
<ul>
<li>Outstream - displays only a series of Ads</li>
<li>Instream - displays video content interleaved with Ads</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><p>The SDK is available as an SPM package on:<br />
<a href="https://github.com/Aniview/ad-player-lite-ios-spm">https://github.com/Aniview/ad-player-lite-ios-spm</a></p>
<p>For more details please refer to:<br />
<a href="https://developer.apple.com/documentation/xcode/adding-package-dependencies-to-your-app">Adding package dependencies to your app</a></p>
<p>See also:<br />
<a href="https://github.com/Aniview/ad-player-lite-ios-example">Example App</a></p>
<div style="break-before: page; page-break-before: always;"></div><p>To integrate the SDK into the project you might want to:</p>
<ul>
<li>Initialize SDK</li>
<li>Request tracking authorization https://developer.apple.com/documentation/apptrackingtransparency</li>
<li>Request GDPR (if applicable)</li>
<li>Add the player to UI Layout<br />
Please refer to the <a href="library/displaying.html">Displaying</a> guide for more details</li>
<li>Ensure the player shows Ads / Content</li>
</ul>
<h2 id="initialize-sdk"><a class="header" href="#initialize-sdk">Initialize SDK</a></h2>
<blockquote>
<p><strong>The SDK must be Initialized before it's used.</strong></p>
</blockquote>
<blockquote>
<p><strong>Please provide the actual AppStore URL.<br />
It's needed for proper ad impression tracking and affects monetization.</strong></p>
</blockquote>
<pre><code class="language-swift">import AdPlayerLite
import UIKit

final class AppDelegate: NSObject, UIApplicationDelegate {
    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]? = nil) -&gt; Bool {
        let storeURL = URL(string: Constants.storeURL)!
        AdPlayer.initSDK(storeUrl: storeURL)
        return true
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="displaying-ads--content"><a class="header" href="#displaying-ads--content">Displaying Ads / Content</a></h2>
<p>This chapter covers ways to display Ads / Content</p>
<ul>
<li><a href="library/displaying-player-uikit.html">UIKit</a></li>
<li><a href="library/displaying-player-swiftui.html">SwiftUI</a></li>
<li><a href="library/interstitial-launch.html">Interstitial</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><p>Here is how to add the Player to the UIkit layout.</p>
<h2 id="adding-adplacementview"><a class="header" href="#adding-adplacementview">Adding AdPlacementView</a></h2>
<pre><code class="language-swift">import UIKit
import AdPlayerLite

class YourViewController: UIViewController {
    override func viewDidLoad() {
        super.viewDidLoad()

        let placement = AdPlacementView(pubId: pubId, tagId: tagId)
        placement.translatesAutoresizingMaskIntoConstraints = false
        view.addSubview(placement)
        NSLayoutConstraint.activate([
            placement.leadingAnchor.constraint(equalTo: view.leadingAnchor),
            placement.trailingAnchor.constraint(equalTo: view.trailingAnchor),
            placement.topAnchor.constraint(equalTo: view.layoutMarginsGuide.topAnchor)
        ])
    }
}
</code></pre>
<blockquote>
<p><strong>Note:</strong> The AdPlacementView's width must be defined.</p>
</blockquote>
<h2 id="observing-players-height-changes"><a class="header" href="#observing-players-height-changes">Observing Player's Height Changes</a></h2>
<blockquote>
<p>This part is optional as long as AdPlacementView resizes automatically.
However it might be useful in order to implement expanding/collapsing animation</p>
</blockquote>
<pre><code class="language-swift">import UIKit
import AdPlayerLite

// viewDidLoad
let placement = AdPlacementView(pubId: pubId, tagId: tagId)
placement.delegate = self
//

extension YourViewController: AdPlacementViewLayoutDelegate {
    func onResize(height: CGFloat) {
        guard lastReportedHeight != height else {
            return
        }
        lastReportedHeight = height
        UIView.animate(withDuration: 0.3) {
            self.view.layoutIfNeeded()
        }
    }
}
</code></pre>
<p>See also: <a href="https://github.com/Aniview/ad-player-lite-ios-example/blob/main/AdPlayerLiteSample/AdPlayerLiteSample/UIKit/SimpleExampleVC.swift">Basic UI Kit Example</a></p>
<div style="break-before: page; page-break-before: always;"></div><p>SwiftUI view is not included in the SDK for the sake of keeping it minimalistic.<br />
However <code>AdPlacementView</code> can be easily wrapped in <code>UIViewRepresentable</code></p>
<p>Please refer to:</p>
<ul>
<li><a href="https://github.com/Aniview/ad-player-lite-ios-example/tree/main/AdPlayerLiteSample/AdPlayerLiteSample/AdPlacement%2BSwiftUI">SampleApp / SwiftUI</a></li>
<li><a href="https://developer.apple.com/documentation/swiftui/uiviewrepresentable">SwiftUI / UIViewRepresentable</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="launching-interstitials"><a class="header" href="#launching-interstitials">Launching Interstitials</a></h1>
<p>Unlike in-read mode, interstitials don't require any placement view. Instead the are always displayed in fullscreen. Interstitials, unlike regular fullscreen, will also be automatically closed after the first video finishes.</p>
<p>Here is a basic example:</p>
<pre><code class="language-swift">AdPlayer.showInterstitial(pubId: pubId, tagId: tagId) {
    // Interstitial has been dismissed
}
</code></pre>
<p>Also, you might want to customise Interstitial's behaviour:</p>
<pre><code class="language-swift">let config = InterstitialConfiguration(
    stalledVideoTimeout: 2.0,
    showCloseButtonAfterAdDuration: true
)
AdPlayer.showInterstitial(pubId: pubId, tagId: tagId, configuration: config) { }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adplayercontroller"><a class="header" href="#adplayercontroller">AdPlayerController</a></h1>
<p>The <code>AdPlayerController</code> is a key component of the AdPlayerLite SDK, designed to manage and control video playback within the <code>AdPlacementView</code>. This guide provides an overview of its features and how to use it effectively.</p>
<h2 id="accessing-the-adplayercontroller"><a class="header" href="#accessing-the-adplayercontroller">Accessing the AdPlayerController</a></h2>
<p>You can obtain an <code>AdPlayerController</code> instance from an <code>AdPlacementView</code> object:</p>
<pre><code class="language-swift">let placement = AdPlacementView(pubId: pubId, tagId: tagId)
let controller = placement.controller
</code></pre>
<p>The <code>AdPlayerController</code> is used to interact with the player, observe its state, and control playback.</p>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<h3 id="player-state"><a class="header" href="#player-state">Player State</a></h3>
<ul>
<li>
<p><strong>Property</strong>: <code>state</code></p>
<ul>
<li>Type: <code>AdPlayerLite.AdPlayerState</code></li>
<li>Description: Represents the current playing state of the player.</li>
</ul>
</li>
<li>
<p><strong>Publisher</strong>: <code>statePublisher</code></p>
<ul>
<li>Type: <code>AnyPublisher&lt;AdPlayerLite.AdPlayerState, Never&gt;</code></li>
<li>Description: Allows observation of the playing state over time.</li>
</ul>
</li>
</ul>
<h3 id="player-events"><a class="header" href="#player-events">Player Events</a></h3>
<ul>
<li><strong>Publisher</strong>: <code>eventsPublisher</code>
<ul>
<li>Type: <code>AnyPublisher&lt;AdPlayerLite.AdPlayerEvent, Never&gt;</code></li>
<li>Description: Emits player events as they occur.</li>
</ul>
</li>
</ul>
<h3 id="current-playing-content"><a class="header" href="#current-playing-content">Current Playing Content</a></h3>
<ul>
<li>
<p><strong>Property</strong>: <code>content</code></p>
<ul>
<li>Type: <code>AdPlayerLite.AdPlayerContent?</code></li>
<li>Description: The currently playing content.</li>
</ul>
</li>
<li>
<p><strong>Publisher</strong>: <code>contentPublisher</code></p>
<ul>
<li>Type: <code>AnyPublisher&lt;AdPlayerLite.AdPlayerContent?, Never&gt;</code></li>
<li>Description: Allows observation of the currently playing content.</li>
</ul>
</li>
</ul>
<h3 id="content-playlist"><a class="header" href="#content-playlist">Content Playlist</a></h3>
<ul>
<li>
<p><strong>Property</strong>: <code>playlist</code></p>
<ul>
<li>Type: <code>[AdPlayerLite.AdPlayerContent]</code></li>
<li>Description: The content playlist managed by the player.</li>
</ul>
</li>
<li>
<p><strong>Publisher</strong>: <code>playlistPublisher</code></p>
<ul>
<li>Type: <code>AnyPublisher&lt;[AdPlayerLite.AdPlayerContent], Never&gt;</code></li>
<li>Description: Allows observation of the content playlist.</li>
</ul>
</li>
</ul>
<h2 id="controlling-playback"><a class="header" href="#controlling-playback">Controlling Playback</a></h2>
<h3 id="basic-controls"><a class="header" href="#basic-controls">Basic Controls</a></h3>
<ul>
<li>
<p><strong>Pause Playback</strong>: <code>pause()</code></p>
<ul>
<li>Pauses the player if it is currently playing.</li>
</ul>
</li>
<li>
<p><strong>Resume Playback</strong>: <code>resume()</code></p>
<ul>
<li>Resumes playback if the player is paused.</li>
</ul>
</li>
<li>
<p><strong>Skip Ad</strong>: <code>skipAd()</code></p>
<ul>
<li>Skips the currently playing ad, if any.</li>
</ul>
</li>
</ul>
<h3 id="fullscreen-mode"><a class="header" href="#fullscreen-mode">Fullscreen Mode</a></h3>
<ul>
<li><strong>Toggle Fullscreen</strong>: <code>toggleFullscreen()</code>
<ul>
<li>Moves the player to or from fullscreen mode.</li>
</ul>
</li>
</ul>
<h3 id="content-navigation"><a class="header" href="#content-navigation">Content Navigation</a></h3>
<ul>
<li>
<p><strong>Play Next Content</strong>: <code>playNextContent()</code></p>
<ul>
<li>Plays the next content in the playlist if available.</li>
</ul>
</li>
<li>
<p><strong>Play Previous Content</strong>: <code>playPrevContent()</code></p>
<ul>
<li>Plays the previous content in the playlist if available.</li>
</ul>
</li>
<li>
<p><strong>Play Content by Index</strong>: <code>playContentByIndex(_ index: Int)</code></p>
<ul>
<li>Plays the content at the specified index in the playlist.</li>
</ul>
</li>
</ul>
<h2 id="playback-information"><a class="header" href="#playback-information">Playback Information</a></h2>
<h3 id="ads"><a class="header" href="#ads">Ads</a></h3>
<ul>
<li><strong>Ready Ads Count</strong>: <code>getReadyAdsCount() async -&gt; Int</code>
<ul>
<li>Returns the number of ads ready to be displayed but not yet shown (outstream only).</li>
</ul>
</li>
</ul>
<h3 id="playback-positions-and-durations"><a class="header" href="#playback-positions-and-durations">Playback Positions and Durations</a></h3>
<ul>
<li>
<p><strong>Ad Position</strong>: <code>getAdPosition() async -&gt; TimeInterval</code></p>
<ul>
<li>Retrieves the current position of the ad being played.</li>
</ul>
</li>
<li>
<p><strong>Ad Duration</strong>: <code>getAdDuration() async -&gt; TimeInterval</code></p>
<ul>
<li>Retrieves the total duration of the ad being played.</li>
</ul>
</li>
<li>
<p><strong>Content Position</strong>: <code>getContentPosition() async -&gt; TimeInterval</code></p>
<ul>
<li>Retrieves the current position of the playing content.</li>
</ul>
</li>
<li>
<p><strong>Content Duration</strong>: <code>getContentDuration() async -&gt; TimeInterval</code></p>
<ul>
<li>Retrieves the total duration of the playing content.</li>
</ul>
</li>
</ul>
<h2 id="observing-player-state-and-events"><a class="header" href="#observing-player-state-and-events">Observing Player State and Events</a></h2>
<p>You can use the provided publishers to observe changes in the player's state, events, content, and playlist. This is particularly useful for updating the UI dynamically.</p>
<p>Example:</p>
<pre><code class="language-swift">import Combine

var cancellables: Set&lt;AnyCancellable&gt; = []

controller.statePublisher
    .sink { state in
        print("Player state: \(state)")
    }
    .store(in: &amp;cancellables)

controller.eventsPublisher
    .sink { event in
        print("Player event: \(event)")
    }
    .store(in: &amp;cancellables)
</code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<ul>
<li>Ensure to manage memory by storing publishers in a <code>Set&lt;AnyCancellable&gt;</code>.</li>
<li>Use async methods like <code>getAdPosition</code> or <code>getContentDuration</code> to retrieve information when needed.</li>
<li>Leverage the <code>statePublisher</code> and <code>eventsPublisher</code> for real-time updates and debugging.</li>
</ul>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>The <code>AdPlayerController</code> provides comprehensive control over the playback of ads and content within the AdPlayerLite SDK. By understanding its features and using the provided methods and publishers, you can build a seamless and interactive video ad experience.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="content-and-playlist"><a class="header" href="#content-and-playlist">Content and Playlist</a></h1>
<p>Both content and playlists are only available for insteam tags.</p>
<h2 id="managing-playlist"><a class="header" href="#managing-playlist">Managing Playlist</a></h2>
<p>Playlist contains list of content videos that are played one after the other. We can read current playlist like this:</p>
<pre><code class="language-swift">let placement = AdPlacementView(pubId: pubId, tagId: tagId)
let controller = placement.controller

let playlist = controller.playlist.value // CAUTION: might not be loaded yet
print(playlist)
</code></pre>
<p>One important note here is that playlist is loaded by the library <em>asynchronously</em> and might not be available right after the controller is created. This might result in the above API returning empty playlist. It is advised, in most cases, for the application to track when playlist changes:</p>
<pre><code class="language-swift">cancellable = controller.playlistPublisher.sink { [weak self] playlist in
  guard let self, playlist.count &gt; 1 else { return }

  print(playlist)
}
</code></pre>
<h2 id="currently-played-content"><a class="header" href="#currently-played-content">Currently Played Content</a></h2>
<p><code>AdPlayerController</code> can be used to track which content is currently playing:</p>
<pre><code class="language-swift">let controller: AdPlayerController = ...

// reading current content
print("\(controller.content) is currently playing")

cancellable = controller.contentPublisher.sink { [weak self] content in
    guard let self else { return }

    print("\(content) is currently playing")
}
</code></pre>
<h2 id="reading-playback-progress"><a class="header" href="#reading-playback-progress">Reading playback progress</a></h2>
<pre><code class="language-swift">let controller: AdPlayerController = ...

Task {
    let duration = await getDuration(isContent: isContent)
    let position = isContent ? await controller.getContentPosition() : await controller.getAdPosition()
    print("Current position \(position) / \(duration)")
}
</code></pre>
<h2 id="choosing-content-to-play"><a class="header" href="#choosing-content-to-play">Choosing Content to Play</a></h2>
<p>In order to play different video from the playlist we can use these functions:</p>
<pre><code class="language-swift">let controller: AdPlayerController = ...

// play next video
controller.playNextContent()

// play previous video
controller.playPrevContent()

// play specific video
controller.playContentByIndex(3)
</code></pre>
<p>See also:<br />
<a href="https://github.com/Aniview/ad-player-lite-ios-example/blob/main/AdPlayerLiteSample/AdPlayerLiteSample/PlayerGui/PlayerTimeIndicator.swift">Time Indicator Example</a></p>
<div style="break-before: page; page-break-before: always;"></div><p>Example App is available here:
<a href="https://github.com/Aniview/ad-player-lite-ios-example">Example App</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
